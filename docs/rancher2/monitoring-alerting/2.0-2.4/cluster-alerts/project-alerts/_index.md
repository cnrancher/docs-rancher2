---
title: 项目告警
description:
keywords:
  - rancher 2.0中文文档
  - rancher 2.x 中文文档
  - rancher中文
  - rancher 2.0中文
  - rancher2
  - rancher教程
  - rancher中国
  - rancher 2.0
  - rancher2.0 中文教程
  - 集群管理员指南
  - 集群访问控制
  - 告警
  - 项目告警
---

## 概述

为了使您的集群和应用程序保持健康，并推动您的组织生产力向前发展，您需要随时了解集群和项目中发生的事件，包括计划内和计划外的事件。当事件发生时，您的警报会被触发，并向您发送通知。然后，如果有必要，您可以通过纠正行动进行跟进。

通知器和警报建立在[Prometheus Alertmanager](https://prometheus.io/docs/alerting/alertmanager/)之上。利用这些工具，Rancher 可以通知 [集群所有者]({{<baseurl>}}/rancher/v2.x/en/admin-settings/rbac/cluster-project-roles/#cluster-roles) 和 [项目所有者]({{<baseurl>}}/rancher/v2.x/en/admin-settings/rbac/cluster-project-roles/#project-roles) 他们需要处理的事件。

在接收警报之前，必须在群集级别配置一个或多个 [notifier]({{<baseurl>}}/rancher/v2.x/en/cluster-admin/tools/notifiers)。

只有[管理员]({{<baseurl>}}/rancher/v2.x/en/admin-settings/rbac/global-permissions/)、[集群所有者或成员]({{<baseurl>}}/rancher/v2.x/en/admin-settings/rbac/cluster-project-roles/#cluster-roles)，或者[项目所有者]({{<baseurl>}}/rancher/v2.x/en/admin-settings/rbac/cluster-project-roles/#project-roles)可以管理项目提醒。

## 告警范围

警报的范围可以在[集群级别]({{<baseurl>}}/rancher/v2.x/en/cluster-admin/tools/alerts/)或项目级别设置。

在项目级别，Rancher 会监控特定的部署，并发送警报。

- 部署可用性
- 工作量状况
- 花苞状态
- 普罗米修斯的表达方式跨越了门槛。

## Default Project-level Alerts

When you enable monitoring for the project, some project-level alerts are provided. You can receive these alerts if a [notifier]({{<baseurl>}}/rancher/v2.x/en/cluster-admin/tools/notifiers) for them is configured at the cluster level.

| 告警                              | 说明                                                                                                                                                                    |
| --------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Less than half workload available | 如果只有不到一半的工作负载可用，就会触发关键警报，其依据是键为`app`，值为`workload`的工作负载。                                                                         |
| Memory usage close to the quota   | 如果工作负载的内存使用量超过了为工作负载设置的内存资源配额，就会触发警告警报。如果您进入**安全和主机配置**选项卡下的工作负载，您可以在 Rancher 用户界面中看到内存限制。 |

关于其他默认警报的信息，请参考[集群级警报]({{<baseurl>}}/rancher/v2.x/en/cluster-admin/tools/alerts/default-alerts)一节。

## 添加项目警报

**前提条件：**在接收项目提醒之前，您必须添加一个通知器。

1. 从**全局**视图中，导航到您要配置项目警报的项目。选择**工具 > 警报**。在 v2.2.0 之前的版本中，您可以选择**资源 > 警报**。

1. 点击**添加告警组**。

1. 为警报输入描述其目的的**名称**，您可以为不同目的的警报规则分组。

1. 根据您要创建的警报类型，完成以下指令子集之一。

该警报类型监控特定 pod 的状态。

1. 选择 **Pod** 选项，然后从下拉列表中选择一个 pod。
1. 1. 选择触发警报的 pod 状态。

   - **未运行**
   - **未安排**
   - **最近 x 分钟重启 y 次**。

1. 选择警报的紧急程度。选项包括

   - **危急**：最紧急
   - **警告**：正常紧急状态
   - **信息**：最不紧急

   根据 pod 状态选择警报的紧急程度。例如，对于作业结束后停止运行的作业 pod，选择 **Info**。但是，如果一个重要的 pod 没有被安排，可能会影响操作，因此选择 **Critical**。

1. 配置高级选项。默认情况下，以下选项将适用于组内的所有警报规则。配置特定规则时，可以禁用这些高级选项。

   - **组等待时间**。在最初发送之前，等待多长时间来缓冲同一组的警报，默认为 30 秒。
   - **组间隔时间**：在发送警报前等待多长时间，默认为 30 秒。在发送已添加到包含已发射的警报的组的警报前要等待多长时间，默认为 30 秒。
   - **重复等待时间**：在发送警报前等待多长时间，默认为 30 秒。**重复等待时间**：在向包含已触发警报的组发送警报前需要等待多长时间，默认为 1 小时。

该警报类型监控工作负载的可用性。

1. 选择 **Workload** 选项。然后从下拉菜单中选择一个工作负载。

1. 使用滑块选择可用性百分比。当工作负载在您的群集节点上的可用性下降到低于设定的百分比时，将触发警报。

1. 1. 选择警报的紧急程度。

   - **危急**。最紧急
   - **警告**。正常紧急状态
   - **信息**。最不紧急

   根据您选择的百分比和工作量的重要性选择警报的紧急程度。

1. 配置高级选项。默认情况下，以下选项将适用于组内的所有警报规则。您可以在配置特定规则时禁用这些高级选项。

   - **组等待时间**。在最初发送之前，等待多长时间来缓冲同一组的警报，默认为 30 秒。
   - 组间隔时间\*\*：在发送警报前等待多长时间，默认为 30 秒。在发送已添加到包含已发射的警报的组的警报前要等待多长时间，默认为 30 秒。
   - 重复等待时间**：在发送警报前等待多长时间，默认为 30 秒。重复等待时间**：在发送已添加到包含已触发警报的组的警报前要等待多长时间，默认为 1 小时。

此警报类型可监控您指定的标记为标签的所有工作负载的可用性。

1. 选择**工作负载选择器**选项，然后单击**添加选择器**，输入标签的键值对。如果其中一个工作负载降至低于您的规格，则会触发警报。此标签应应用于您的一个或多个工作负载。

1. 1. 选择警报的紧急程度。

   - **危急**。最紧急
   - **警告**。正常紧急状态
   - **信息**。最不紧急

   根据您选择的百分比和工作量的重要性选择警报的紧急程度。

1. 配置高级选项。默认情况下，以下选项将适用于组内的所有警报规则。您可以在配置特定规则时禁用这些高级选项。

   - **组等待时间**。在最初发送之前，等待多长时间来缓冲同一组的警报，默认为 30 秒。
   - 组间隔时间\*\*：在发送警报前等待多长时间，默认为 30 秒。在发送已添加到包含已发射的警报的组的警报前要等待多长时间，默认为 30 秒。
   - 重复等待时间**：在发送警报前等待多长时间，默认为 30 秒。重复等待时间**：在向包含已触发警报的组发送警报前需要等待多长时间，默认为 1 小时。

\_从 v2.2.4 开始提供。

如果启用了[项目监控]({{<baseurl>}}/rancher/v2.x/en/project-admin/tools/#monitoring)，该警报类型可以监控 Prometheus 表达式查询的超载情况。

1. 输入或选择一个**表达式**，下拉显示来自 Prometheus 的原始指标，包括。

- [**容器**](https://github.com/google/cadvisor)
- [**Kubernetes 资源**](https://github.com/kubernetes/kube-state-metrics)
- [**自定义**]({{<baseurl>}}/rancher/v2.x/en/project-admin/tools/monitoring/#project-metrics)
- [**项目级 Grafana**](http://docs.grafana.org/administration/metrics/)
- **项目级普罗米修斯**。

1. 选择比较。

- 2.**等于**。当表达式的值等于阈值时，触发警报。
- 不等于\*\*。当表达式的值不等于阈值时，触发警报。
- 大于\*\*：当表达式的值大于阈值时触发警报。当表达式的值大于阈值时触发警报。
- 小于**：当表达式的值等于或小于**时，触发警报。当表达式的值等于或小于阈值时，触发警报。
- 大于或等于**：当表达式的值大于或小于阈值时触发警报。大于或等于**: 当表达式的值大于或等于阈值时触发警报。
- 小于或等于\*\*：当表达式的值小于或等于阈值时，触发警报。当表情值小于或等于阈值时，触发警报。

1.  1.输入**阈值**，当表达式的值超过阈值时触发警报。

1.  选择一个**比较**。

1.  选择**持续时间**，当表达式的值超过阈值时，触发警报。

1.  选择警报的紧急程度。

    - 选择**紧急**。最紧急
    - **警告**。正常紧急状态
    - **信息**。最不紧急

      根据警报对操作的影响，选择警报的紧急程度。例如，当容器内存接近极限的表达式提高到 60%以上时触发的警报认为是**信息**的紧急程度，但提高到 95%左右则认为是**关键**的紧急程度。

1.  配置高级选项。默认情况下，以下选项将适用于组内的所有警报规则。您可以在配置特定规则时禁用这些高级选项。

        - **组等待时间**。在最初发送之前，等待多长时间来缓冲同一组的警报，默认为30秒。
        - 组间隔时间**：在发送警报前等待多长时间，默认为30秒。在发送已添加到包含已发射的警报的组的警报前要等待多长时间，默认为30秒。
        - 重复等待时间**：在发送警报前等待多长时间，默认为30秒。重复等待时间**：在发送已被添加到包含已触发警报的组的警报前需要等待多长时间，默认为1小时。

1.  继续向组中添加更多**警报规则**。

1.  最后，选择向你发送警报的[notifiers]({{<baseurl>}}/rancher/v2.x/en/cluster-admin/tools/notifiers/)。

    - 你可以设置多个通知器。
    - 你可以随时更改通知者的收件人。

**结果:**您的警报已被配置。当警报被触发时，将发送一个通知。

## 管理项目警报

要管理项目警报，请浏览到您要管理警报的项目。然后选择**工具 > 警报**。在 v2.2.0 之前的版本中，您可以选择**资源 > 警报**。您可以

- 停用/被动警报
- 编辑警报设置
- 删除不必要的警报
- 静音射击警报
- 静音静音警报
