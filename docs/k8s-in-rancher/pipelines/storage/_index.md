---
title: 配置流水线组件的持久存储
description: Docker 镜像仓库和 Minio 工作负载默认使用临时存储，临时存储足以应对对大多数情况。如果您希望流水线内嵌的镜像仓库中的镜像和流水线日志在节点失败的情况下能被保存下来，您可以给镜像日志配置持久存储。下文提供了配置持久存储的操作指导。
keywords:
  - rancher 2.0中文文档
  - rancher 2.x 中文文档
  - rancher中文
  - rancher 2.0中文
  - rancher2
  - rancher教程
  - rancher中国
  - rancher 2.0
  - rancher2.0 中文教程
  - 用户指南
  - 流水线
  - 配置流水线组件的持久存储
---

Docker 镜像仓库和 Minio 工作负载默认使用临时存储，临时存储足以应对大多数情况。如果您希望流水线内嵌的镜像仓库中的镜像和流水线日志在节点失败的情况下能被保存下来，您可以给镜像日志配置持久存储。下文提供了配置持久存储的操作指导。

本节假定您了解持久存储在 Kubernetes 中的工作方式。有关更多信息，请参阅[存储如何工作](/docs/cluster-admin/volumes-and-storage/how-storage-works/_index)部分。

> **先决条件：**
>
> 集群必须有可用的[持久存储](/docs/k8s-in-rancher/volumes-and-storage/_index)。

## 配置内置镜像仓库的持久存储

1. 从需要配置流水线的项目选择**资源 > 工作负载**。如果您使用的是 v2.3.0 之前的版本，请选择**工作负载**。

1. 找到 `docker-registry`的工作负载，选择 **... > 编辑**。

1. 找到“持久卷”的部分，展开选项。单击**添加卷**，从下列两个选项中选择一个：

   - **添加卷 > 添加新的持久卷**
   - **添加卷 > 使用已有的持久卷**

1. 填写 UI 界面提供的表格，选择内部镜像仓库使用的持久卷。

### 添加新的持久卷

1. 输入持久卷的**名称**。

1. 选择持久卷的**源**

   - 如果您选择的是**使用存储类创建新的持久卷**，您需要选择[存储类](/docs/cluster-admin/volumes-and-storage/_index)，输入**容量**。

   - 如果您选择 **使用现有的持久卷**，请直接输入**容量**。

1. 在**自定义**的部分勾选存储卷的读写权限。

1. 单击**配置**。

### 使用已有的持久卷

1. 输入持久卷的**名称**。

1. 选择一个持久卷。

1. 在**自定义**的部分勾选存储卷的读写权限。

1. 单击**配置**。

### 后续步骤

1. 在**挂载**对应的文本框输入镜像仓库数据存储的路径：`/var/lib/registry`。

1. 单击 **升级**。

## 配置 Minio 的数据存储

1. 从项目视图选择**资源 > 工作负载**（如果您使用的是 v2.3.0 之前的版本，请单击**工作负载**）。找到`minio`工作负载，然后选择 **... > 编辑**。

1. 找到“持久卷”的部分，展开选项。单击**添加卷**，从下列两个选项中选择一个：

   - **添加卷 > 添加新的持久卷**
   - **添加卷 > 使用已有的持久卷**

1. 填写 UI 界面提供的表格，选择内部镜像仓库使用的持久卷

### 添加新的持久卷

1. 输入持久卷的**名称**。

1. 选择持久卷的**源**

   - 如果您选择的是**使用存储类创建新的持久卷**，您需要选择[存储类](/docs/cluster-admin/volumes-and-storage/_index)，输入**容量**。

   - 如果您选择 **使用现有的持久卷**，请直接输入**容量**。

1. 在**自定义**的部分勾选存储卷的读写权限。

1. 单击 **配置**。

### 使用已有的持久卷

1. 输入持久卷的**名称**。

1. 选择一个持久卷。

1. 在**自定义**的部分勾选存储卷的读写权限。

1. 单击**配置**。

### 后续步骤

1. 在**挂载**对应的文本框输入 Minio 数据存储的路径：`/data`。

1. 单击 **升级**。

**结果：** 完成流水组件的持久存储配置。
